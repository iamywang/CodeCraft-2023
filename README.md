# CodeCraft-2023
华为软件精英挑战赛2023

## 贪心算法介绍

### 变量说明

- map<int, pair<int, int>> item_prices: <物品编号, <买入价格, 原始出售价格>>
- map<int, int> item_recipes: <工作台编号, 所需物品二进制格表示>
- map<int, vector<int>> item_demand: <物品编号, [当前帧能够接收这种物品的工作台列表]>
- map<int, int> available_demand: <物品编号, 当前帧能够接收这种物品的工作台数量-机器人已经买入过该类物品的数量>
- map<int, vector<int>> item_supply: <物品编号, [当前帧机器人能够从哪些工作台购买该物品]>

### 可调整参数
速度过大撞墙问题，角速度与线速度修正参数：
- #define angle_fix 0.99
- #define forward_fix 0.95

速度过大撞墙问题，机器人与墙壁的间距：
- #define wall_margin 3.5

机器人是否在工作台判断距离（原始值为0.4）：
- #define distance_within 0.4

贪心策略中，时间系数的估计值：
- #define time_coefficient 0.9

### 贪心策略

- 如果机器人目前没有持有物品，则其需要购买物品
    - 根据item_demand和available_demand，机器人可以知道其能够购买哪些种类的物品
    - 根据item_supply，机器人能够知道其能够从哪些工作台购买物品
    - 排序策略：按照机器人距离工作台的距离（直线距离）/利润（item_prices.second * 损失系数 - item_prices.first）进行排序
    - 选择策略：选择第一个满足条件的工作台，购买后available_demand的值减小1

- 如果机器人目前持有物品，则其需要出售物品
    - 根据item_demand，机器人可以知道其能够向哪些工作台出售该物品
    - 排序策略：按照机器人距离工作台的距离（直线距离）进行排序
    - 选择策略：选择第一个满足条件的工作台，出售后立即判断是否能够买入

### 优化策略

- 损失系数：
    - 时间损失 * 碰撞损失，根据实际情况发现0.9时较优
- 角速度：
    - 按照机器人当前方向和目标方向的夹角，计算出在最大角速度下的旋转时间（精确到帧），并调节角速度
    - 控制机器人时，角速度为该角速度 * 角速度调节系数（0.99）
- 线速度：
    - 按照机器人当前位置和目标位置的直线距离，计算出在最大线速度下的移动时间（精确到帧），并调节先速度
    - 控制机器人时，线速度为该线速度 * 线速度调节系数（0.95）
- 角速度与线速度同时调整：
    - 两者同时调整，似乎没发现什么问题（虽然有时可能会有行星旋转的情况）
- 撞墙问题：
    - 解决方式是机器人到达预期位置附近，发现快要撞墙时（与四周的间距），将线速度与角速度的预期值设置为允许的负数值，使得机器人能够在撞墙前停下来
    - 目前该间距设置为3.5，可以根据实际情况调整
    - 如果没有发现撞墙，就设置为max(0 - line_speed, double(min_forward_speed))
